# 文件监听

## 需求类型

- 监听一个目录中所有文件，文件大小到一定阀值，则处理；
- 监控某个目录，当有文件新增，立马处理；
- 监控某个目录或文件，当有文件被修改或者删除，立马能感知，进行处理；

## 常用办法

1. 第一种：当事人主动通知你，这是侵入式的，需要当事人修改这部分代码来支持，依赖于当事人的自觉；
2. 第二种：轮询观察，这个是无侵入式的，你可以自己写个轮询程序，每隔一段时间唤醒一次，对文件和目录做各种判断，从而得到这个目录的变化；
3. 第三种：操作系统支持，以事件的方式通知到订阅这个事件的用户，达到及时处理的目的；

## inotify机制

```shell
# fs/notify/inotify/inotify_user.c

# 创建 notify fd
inotify_init1

# 添加监控路径
inotify_add_watch

# 删除一个监控
inotify_rm_watch
```
